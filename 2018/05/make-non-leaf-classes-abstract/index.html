<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="刀心の水">
<meta name="keywords" content=", visual, music, technology">
<meta name="description" content="The general rule: non-leaf classes should be abstract. This will yields dividends in the form of increased reliability, robustness, comprehensibility, and extensibility throughout our software.">


<meta property="og:description" content="The general rule: non-leaf classes should be abstract. This will yields dividends in the form of increased reliability, robustness, comprehensibility, and extensibility throughout our software.">
<meta property="og:type" content="article">
<meta property="og:title" content="[MECpp]Item-33 Make Non-Leaf Classes Abstract">
<meta name="twitter:title" content="[MECpp]Item-33 Make Non-Leaf Classes Abstract">
<meta property="og:url" content="https://nianze.tk/2018/05/make-non-leaf-classes-abstract/">
<meta property="twitter:url" content="https://nianze.tk/2018/05/make-non-leaf-classes-abstract/">
<meta property="og:site_name" content="刀心水敲字の地方">
<meta property="og:description" content="The general rule: non-leaf classes should be abstract. This will yields dividends in the form of increased reliability, robustness, comprehensibility, and extensibility throughout our software.">
<meta name="twitter:description" content="The general rule: non-leaf classes should be abstract. This will yields dividends in the form of increased reliability, robustness, comprehensibility, and extensibility throughout our software.">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2018-05-21T18:27:39">
  
  
    <meta property="article:modified_time" content="2018-05-21T18:27:39">
  
  
  
    
      <meta property="article:section" content="technology">
    
      <meta property="article:section" content="coding">
    
  
  
    
      <meta property="article:tag" content="technique">
    
      <meta property="article:tag" content="cpp">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://nianze.tk/images/2018/2018-05/2018-05-21.gif">
  <meta property="twitter:image" content="https://nianze.tk/images/2018/2018-05/2018-05-21.gif">





  <meta property="og:image" content="https://nianze.tk/images/bw.JPG">
  <meta property="twitter:image" content="https://nianze.tk/images/bw.JPG">


    <title>[MECpp]Item-33 Make Non-Leaf Classes Abstract</title>

    <link rel="icon" href="https://nianze.tk/images/favicon.png">
    

    

    <link rel="canonical" href="https://nianze.tk/2018/05/make-non-leaf-classes-abstract/">

    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://nianze.tk/css/style-nnm2spxvve8onlujjlegkkytaehyadd4ksxc1hyzzq9a2wvtrgbljqyulomn.min.css" />
    
    
      
        <link rel="stylesheet" href="https://nianze.tk/css/main.css">
      
    
      
        <link rel="stylesheet" href="https://nianze.tk/css/loader.css">
      
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-71584380-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body id="container">
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fas fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://nianze.tk/">刀心水敲字の地方</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://nianze.tk/#about">
    
    
    
      
        <img class="header-picture" src="https://nianze.tk/images/bw.JPG" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://nianze.tk/#about">
          <img class="sidebar-profile-picture" src="https://nianze.tk/images/bw.JPG" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">刀心の水</h4>
        
          <h5 class="sidebar-profile-bio"><p>虚度廿余岁月浅，略识几行代码源。<br />
闲来随手快门按，怆然独把音韵弹。</p>

<p>Pain is inevitable.<br />
Suffering is optional.</p>
</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/">
    
      <i class="sidebar-button-icon fas fa-home" title='Home'></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories/thoughts">
    
      <i class="sidebar-button-icon fas fa-lightbulb" title='Thoughts'></i>
      
      <span class="sidebar-button-desc">Thoughts</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories/technology">
    
      <i class="sidebar-button-icon fas fa-code" title='Technology'></i>
      
      <span class="sidebar-button-desc">Technology</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories/music">
    
      <i class="sidebar-button-icon fas fa-music" title='Music'></i>
      
      <span class="sidebar-button-desc">Music</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories/visual">
    
      <i class="sidebar-button-icon fas fa-palette" title='Visual'></i>
      
      <span class="sidebar-button-desc">Visual</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories">
    
      <i class="sidebar-button-icon fas fa-bookmark" title='Categories'></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/tags">
    
      <i class="sidebar-button-icon fas fa-tags" title='Tags'></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/archives">
    
      <i class="sidebar-button-icon fas fa-archive" title='Archives'></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/about">
    
      <i class="sidebar-button-icon fas fa-user" title='About'></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/nianze" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-linkedin" title='LinkedIn'></i>
      
      <span class="sidebar-button-desc">LinkedIn</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/Nianze" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-github" title='Github'></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.flickr.com/photos/129774362@N07/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-flickr", title='Flickr'></i>
      
      <span class="sidebar-button-desc">Flickr</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://instagram.com/eznain" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-instagram" title='Instagram'></i>
      
      <span class="sidebar-button-desc">Instagram</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.facebook.com/rym.lnz" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-facebook", title='Facebook'></i>
      
      <span class="sidebar-button-desc">Facebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/daoxinzhishui" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-twitter", title='Twitter'></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.youtube.com/user/daoxinzhishui" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-youtube", title='YouTube'></i>
      
      <span class="sidebar-button-desc">YouTube</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="mailto:daoxinzhishui@gmail.com" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fas fa-envelope", title='Email'></i>
      
      <span class="sidebar-button-desc">Email</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/post/index.xml">
    
      <i class="sidebar-button-icon fas fa-rss-square", title='RSS'></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      [MECpp]Item-33 Make Non-Leaf Classes Abstract
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-05-21T18:27:39-04:00">
        
  May 21, 2018

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://nianze.tk/categories/technology">technology</a>, 
    
      <a class="category-link" href="https://nianze.tk/categories/coding">coding</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>The general rule: non-leaf classes should be abstract. This will yields dividends in the form of increased reliability, robustness, comprehensibility, and extensibility throughout our software.</p>

<h1 id="table-of-contents">Table of Contents</h1><nav id="TableOfContents">
<ul>
<li><a href="#redesign-concrete-base-classes-to-abstract-ones">Redesign concrete base classes to abstract ones</a>
<ul>
<li><a href="#solution-1-virtual-functions">Solution 1: virtual functions</a></li>
<li><a href="#solution-2-adding-another-function">Solution 2: adding another function</a></li>
<li><a href="#solution-3-making-partial-assignment-illegal">Solution 3: making partial assignment illegal</a></li>
<li><a href="#solution-4-redesign-the-inheritance-hierarchy">Solution 4: redesign the inheritance hierarchy</a></li>
</ul></li>
<li><a href="#in-reality-when-facing-constraints">In reality when facing constraints</a></li>
</ul>
</nav>

<h1 id="redesign-concrete-base-classes-to-abstract-ones">Redesign concrete base classes to abstract ones</h1>

<p>If we have two concrete classes C1 and C2 and we&rsquo;d like C2 to publicly inherit from C1, we should transform that two-class hierarchy into a three-class hierarchy by creating a new class A and having both C1 and C2 publicly inherit from it:</p>
<pre><code>initial idea  |             the transformed hierarchy
┌─────────┐   |                    ┌─────┐
│   C1    │   |                    │  A  │
└─────────┘   |                    └─────┘
     ↑        | public inheritance ↗     ↖ public inheritance
┌─────────┐   |              ┌────┐      ┌────┐
│   C1    │   |              │ C1 │      │ C2 │
└─────────┘   |              └────┘      └────┘</code></pre>
<p>For example, we create a software dealing with animals, with two kinds of animals - lizards and chickens - require special handling:</p>
<pre><code>                    ┌──────────┐
                    │  Animal  │
                    └──────────┘
   public inheritance ↗     ↖ public inheritance
             ┌────────┐      ┌─────────┐
             │ Lizard │      │ Chicken │
             └────────┘      └─────────┘</code></pre>
<p>The <code>Animal</code> class embodies the features shared by all the creatures, and the <code>Lizerd</code> and <code>Chicken</code> classes specialize <code>Animal</code> in their own ways:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Animal</span> {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    Animal<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Animal<span style="color:#f92672">&amp;</span> rhs);
    ...
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Lizard</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Animal {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    Lizard<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Lizard<span style="color:#f92672">&amp;</span> rhs);
    ...
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Chicken</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Animal {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    Chicken<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Chicken<span style="color:#f92672">&amp;</span> rhs);
    ...
};
</code></pre></div>
<p>Now consider what happens for assignment operation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">Lizard liz1;
Lizard liz2;
Animal <span style="color:#f92672">*</span>pAni1 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>liz1;
Animal <span style="color:#f92672">*</span>pAni2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>liz2;
...
<span style="color:#f92672">*</span>pAni1 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>pAni2;
</code></pre></div>
<p>The two problems here:</p>

<ol>
<li><em>partial assignment</em>: only <code>Animal</code> members in <code>liz1</code> get updated from <code>liz2</code>, while the <code>liz1</code>&rsquo;s Lizard members remain unchanged.</li>
<li>it&rsquo;s not uncommon for programmers to make assignments to objects via pointers.</li>
</ol>

<h2 id="solution-1-virtual-functions">Solution 1: virtual functions</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Animal</span> {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">virtual</span> Animal<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Animal<span style="color:#f92672">&amp;</span> rhs);
    ...
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Lizard</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Animal {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">virtual</span> Lizard<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Animal<span style="color:#f92672">&amp;</span> rhs);
    ...
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Chicken</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Animal {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">virtual</span> Chicken<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Animal<span style="color:#f92672">&amp;</span> rhs);
    ...
};
</code></pre></div>
<p>We can customize the return value of the virtual assignment operators here, but the rules of C++ force us to declare identical <em>parameter</em> types for a virtual function in every class in which it is declared, leading to the problem that the assignment operator for the <code>Lizard</code> and <code>Chicken</code> must be prepared to accept <em>any</em> kind of <code>Animal</code> object on the right-hand side of an assignment:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">Lizard liz;
Chicken chick;

Animal <span style="color:#f92672">*</span>pAni1 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>liz;
Animal <span style="color:#f92672">*</span>pAni2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>chick;

...

<span style="color:#f92672">*</span>pAni1 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>pAni2; <span style="color:#75715e">// assign a chicken to a lizard!
</span></code></pre></div>
<p>By making <code>Animal</code>&rsquo;s assignment operator virtual, we opened the door to such mixed-type operations. To only allow the same type assignment in virtual assignment operation, we have to make distinctions the types at runtime:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">Lizard<span style="color:#f92672">&amp;</span> Lizard<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Animal<span style="color:#f92672">&amp;</span> rhs)
{
    <span style="color:#75715e">// make sure rhs is really a lizard
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> Lizard<span style="color:#f92672">&amp;</span> rhs_liz <span style="color:#f92672">=</span> <span style="color:#66d9ef">dynamic_cast</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">const</span> Lizard<span style="color:#f92672">&amp;</span><span style="color:#f92672">&gt;</span>(rhs);
    ... <span style="color:#75715e">// proceed with a normal assignment of rhs_liz to *this
</span><span style="color:#75715e"></span>}
</code></pre></div>
<p>In this case, we have to worry about <code>std::bad_cast</code> exceptions thrown by <code>dynamic_cast</code> when <code>rhs</code> is not a <code>Lizard</code>, while paying for extra runtime check cost for valid assignment cases, as well as the harder to maintain code.</p>

<h2 id="solution-2-adding-another-function">Solution 2: adding another function</h2>

<p>If we don&rsquo;t want to pay for the complexity or cost of a <code>dynamic_cast</code> in the case of valid assignment, we add to <code>Lizard</code> the conventional assignment operator:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Lizard</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> Animal {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">virtual</span> Lizard<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Animal<span style="color:#f92672">&amp;</span> rhs);
    Lizard<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Lizard<span style="color:#f92672">&amp;</span> rhs);  <span style="color:#75715e">// add this
</span><span style="color:#75715e"></span>    ...
};

Lizard<span style="color:#f92672">&amp;</span> Lizard<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Animal<span style="color:#f92672">&amp;</span> rhs)
{
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">dynamic_cast</span><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">const</span> Lizard<span style="color:#f92672">&amp;</span><span style="color:#f92672">&gt;</span>(rhs));
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">Lizard liz1, liz2;
...
liz1 <span style="color:#f92672">=</span> liz2;   <span style="color:#75715e">// calls operator= taking a const Lizard&amp;
</span><span style="color:#75715e"></span>
Animal <span style="color:#f92672">*</span>pAni1 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>liz1;
Animal <span style="color:#f92672">*</span>pAni2 <span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>liz2;
...
<span style="color:#f92672">*</span>pAni1 <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>pAni2;  <span style="color:#75715e">// calls operator= taking a const Animal&amp;
</span></code></pre></div>
<p>Still, clients of <code>Lizard</code> and <code>Chicken</code> have to be prepared to catch <code>bad_cast</code> exceptions and do something sensible with them each time they perform an assignment, which most programmers are unwilling to do.</p>

<h2 id="solution-3-making-partial-assignment-illegal">Solution 3: making partial assignment illegal</h2>

<p>The easiest way to prevent partial assignments is to make <code>Animal::operator=</code> private so that <code>*pAni1 = *pAni2;</code> is illegal (which calls private <code>Animal::operator=</code>), but this naive solution has 2 problems:</p>

<ol>
<li><code>Animal</code> is a concrete class. A private <code>operator=</code> makes also it illegal to make assignments between <code>Animal</code> objects: <code>animal1 = animal2;</code></li>

<li><p>Assignment operator in derived classes are responsible for calling assignment operators in their base classes, but a private <code>Animal::operator=</code> makes it impossible to implement the <code>Lizard::operator=</code> and <code>Chicken::operator=</code> correctly to assign the <code>Animal</code> part of <code>*this</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">Lizard<span style="color:#f92672">&amp;</span> Lizard<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Lizard<span style="color:#f92672">&amp;</span> rhs)
{
    <span style="color:#66d9ef">if</span> (<span style="color:#66d9ef">this</span> <span style="color:#f92672">=</span><span style="color:#f92672">=</span> <span style="color:#f92672">&amp;</span>rhs) <span style="color:#66d9ef">return</span> <span style="color:#f92672">*</span><span style="color:#66d9ef">this</span>;
    Animal<span style="color:#f92672">:</span><span style="color:#f92672">:</span><span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(rhs); <span style="color:#75715e">// can&#39;t call private Animal::operator=
</span><span style="color:#75715e"></span>    ...
}
</code></pre></div></li>
</ol>

<p>Declaring <code>Animal::operator=</code> as <code>protected</code> will solve the latter problem, but the first one still remains.</p>

<h2 id="solution-4-redesign-the-inheritance-hierarchy">Solution 4: redesign the inheritance hierarchy</h2>

<p>Because our orignimal design for the system presupposed that <code>Animal</code> objects were necessary, we can not abstract <code>Animal</code> class. Instead, we create a new class - <code>AbstractAnimal</code> that consists of the common features of <code>Animal</code>, <code>Lizard</code>, and <code>Chicken</code>, and we make <em>that</em> class abstract by making its destructor a pure virtual function<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AbstractAnimal</span> {
<span style="color:#66d9ef">protected</span><span style="color:#f92672">:</span>
    AbstractAnimal<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> AbstractAnimal<span style="color:#f92672">&amp;</span> rhs);
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>AbstractAnimal() <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#75715e">// still need to impl. the destructor even it&#39;s a pure virtual function
</span><span style="color:#75715e"></span>    ...
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Animal</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> AbstractAnimal {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    Animal<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Animal<span style="color:#f92672">&amp;</span> rhs);
    ...
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Lizard</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> AbstractAnimal {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    Lizard<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Lizard<span style="color:#f92672">&amp;</span> rhs);
    ...
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Chicken</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> AbstractAnimal {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    Chicken<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">=</span>(<span style="color:#66d9ef">const</span> Chicken<span style="color:#f92672">&amp;</span> rhs);
};
</code></pre></div>
<p>This design gives us everything:</p>

<ul>
<li>homogeneous assignments ar allowed for lizards, chickens, and animals;</li>
<li>partial assignments and heterogeneous assignments are prohibited</li>
<li>derived class assignment operators may call the assignment operator in the base class</li>
<li>non of the code written in terms of the <code>Animal</code>, <code>Lizard</code>, or <code>Chicken</code> requires modification - they behave as they did before <code>AbstractAnimal</code> was introduced - though the code does need to be recompiled</li>
</ul>

<h1 id="in-reality-when-facing-constraints">In reality when facing constraints</h1>

<p>If we want wot create a concrete class that inherits from a concrete class in a thirt-party libraries to which we have only read access, what are we to do?</p>

<p>Then there are only unappealing options:</p>

<ul>
<li>Derive the concrete class from the existing concrete class, and put up with the assignment-related problems, and watch out for the array-related pitfalls (MECpp item 3).</li>
<li>Try to find an abstract class higher in the library hierarchy that does most of what we need, then inherit from that class.</li>

<li><p>Implement the new class in terms of the library class we&rsquo;d like to inherit from: having an object of the library class as a data member, then reimplement the library class&rsquo;s interface in the new class - this requires to update the class each time the library vendor updates our dependent library classes, and we also give up the ability to redefine virtual functions declared in the library class (we can&rsquo;t redefine virtual functions unless we inherit them):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Window</span> {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> resize(<span style="color:#66d9ef">int</span> newWidth, <span style="color:#66d9ef">int</span> newHeight);
    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">repaint</span>() <span style="color:#66d9ef">const</span>;

    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">width</span>() <span style="color:#66d9ef">const</span>;
    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">height</span>() <span style="color:#66d9ef">const</span>;
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SpecialWindow</span> { <span style="color:#75715e">// class we wanted to have inherit from Window
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    ...
    <span style="color:#66d9ef">int</span> width() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> w.width(); } <span style="color:#75715e">// pass through nonvirtual functions
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">height</span>() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> w.height(); }

    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">resize</span>(<span style="color:#66d9ef">int</span> newWidth, <span style="color:#66d9ef">int</span> newHeight); <span style="color:#75715e">// new impl. of &#34;inherited&#34; virtual functions
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">repaint</span>() <span style="color:#66d9ef">const</span>;
<span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
    Window w;
};
</code></pre></div></li>

<li><p>Use the concrete class that&rsquo;s in the library and modify the software so that the class suffices. Write non-member functions to proved the extra functionality we&rsquo;d like to add to the class, but can&rsquo;t - the result may not be as clear, as efficient, as maintainable, or as extensible as we&rsquo;d like.</p></li>
</ul>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">Declaring a function pure virtual doesn&rsquo;t mean it has no implementation, it means: 1. the current class is abstract, and 2 any concrete class inheriting from the current class must declare the function as a &ldquo;normal&rdquo; virtual function (i.e., without the &ldquo;=0&rdquo;).
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
</ol>
</div>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://nianze.tk/tags/technique/">technique</a>

  <a class="tag tag--primary tag--small" href="https://nianze.tk/tags/cpp/">cpp</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://nianze.tk/2018/05/understand-how-to-combine-c-and-c-in-the-same-program/" data-tooltip="[MECpp]Item-34 Understand How to Combine C&#43;&#43; and C in the Same Program">
              
                  <i class="fas fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://nianze.tk/2018/05/program-in-the-future-tense/" data-tooltip="[MECpp]Item-32 Program in the Future Tense">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fas fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fas fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://nianze.tk/2018/05/make-non-leaf-classes-abstract/">
              <i class="fab fa-facebook-f"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://nianze.tk/2018/05/make-non-leaf-classes-abstract/">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://nianze.tk/2018/05/make-non-leaf-classes-abstract/">
              <i class="fab fa-google-plus-g"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#utteranc_thread" data-tooltip="Comments">
            <i class="fas fa-comment-dots"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents" data-tooltip="Table of Contents">
            <i class="fas fa-list"></i>
        
          </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="utteranc_thread">
  <script src="https://utteranc.es/client.js"
    repo= "Nianze/personal-site-comments"
    issue-term="pathname"
    theme="github-light"
    label="✨comment 💬"
    crossorigin="anonymous"
    async>
  </script>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2019 刀心の水. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://nianze.tk/2018/05/understand-how-to-combine-c-and-c-in-the-same-program/" data-tooltip="[MECpp]Item-34 Understand How to Combine C&#43;&#43; and C in the Same Program">
              
                  <i class="fas fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://nianze.tk/2018/05/program-in-the-future-tense/" data-tooltip="[MECpp]Item-32 Program in the Future Tense">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fas fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fas fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://nianze.tk/2018/05/make-non-leaf-classes-abstract/">
              <i class="fab fa-facebook-f"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://nianze.tk/2018/05/make-non-leaf-classes-abstract/">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://nianze.tk/2018/05/make-non-leaf-classes-abstract/">
              <i class="fab fa-google-plus-g"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#utteranc_thread" data-tooltip="Comments">
            <i class="fas fa-comment-dots"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents" data-tooltip="Table of Contents">
            <i class="fas fa-list"></i>
        
          </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fas fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fnianze.tk%2F2018%2F05%2Fmake-non-leaf-classes-abstract%2F">
          <i class="fa fa-facebook-f"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fnianze.tk%2F2018%2F05%2Fmake-non-leaf-classes-abstract%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3A%2F%2Fnianze.tk%2F2018%2F05%2Fmake-non-leaf-classes-abstract%2F">
          <i class="fa fa-google-plus-g"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fas fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://nianze.tk/images/bw.JPG" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">刀心の水</h4>
    
      <div id="about-card-bio"><p>虚度廿余岁月浅，略识几行代码源。<br />
闲来随手快门按，怆然独把音韵弹。</p>

<p>Pain is inevitable.<br />
Suffering is optional.</p>
</div>
    
    
      <div id="about-card-job">
        <i class="fas fa-laptop-code"></i>
        <br/>
        Developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fas fa-map-marked-alt"></i>
        <br/>
        New York
      </div>
    
  </div>
</div>

    

    
  
    
    <div id="cover" style="background-image:url('https://nianze.tk/images/road.JPG');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.2.0/imagesloaded.pkgd.min.js"></script>


<script src="https://nianze.tk/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>


  
    <script src="https://nianze.tk/js/loader.js"></script>
  

<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>





    
  </body>
</html>

