<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="author" content="刀心の水">
<meta name="keywords" content=", visual, music, technology">
<meta name="description" content="Being more complex than single inheritance, Multiple inheritance (MI) can lead to ambiguity issues and to the need for virtual inheritance, the latter of which imposes costs in size, speed, and complexity of initialization and assignment, so it&rsquo;s more practical to make &ldquo;empty&rdquo; virtual base classes.">


<meta property="og:description" content="Being more complex than single inheritance, Multiple inheritance (MI) can lead to ambiguity issues and to the need for virtual inheritance, the latter of which imposes costs in size, speed, and complexity of initialization and assignment, so it&rsquo;s more practical to make &ldquo;empty&rdquo; virtual base classes.">
<meta property="og:type" content="article">
<meta property="og:title" content="Item-40 Use multiple inheritance judiciously">
<meta name="twitter:title" content="Item-40 Use multiple inheritance judiciously">
<meta property="og:url" content="https://nianze.tk/2018/03/use-multiple-inheritance-judiciously/">
<meta property="twitter:url" content="https://nianze.tk/2018/03/use-multiple-inheritance-judiciously/">
<meta property="og:site_name" content="刀心水敲字の地方">
<meta property="og:description" content="Being more complex than single inheritance, Multiple inheritance (MI) can lead to ambiguity issues and to the need for virtual inheritance, the latter of which imposes costs in size, speed, and complexity of initialization and assignment, so it&rsquo;s more practical to make &ldquo;empty&rdquo; virtual base classes.">
<meta name="twitter:description" content="Being more complex than single inheritance, Multiple inheritance (MI) can lead to ambiguity issues and to the need for virtual inheritance, the latter of which imposes costs in size, speed, and complexity of initialization and assignment, so it&rsquo;s more practical to make &ldquo;empty&rdquo; virtual base classes.">
<meta property="og:locale" content="en-us">

  
    <meta property="article:published_time" content="2018-03-06T17:35:59">
  
  
    <meta property="article:modified_time" content="2018-03-06T17:35:59">
  
  
  
    
      <meta property="article:section" content="technology">
    
      <meta property="article:section" content="coding">
    
  
  
    
      <meta property="article:tag" content="technique">
    
      <meta property="article:tag" content="cpp">
    
  


<meta name="twitter:card" content="summary">







  <meta property="og:image" content="https://nianze.tk/images/2018/2018-03/2018-03-06.gif">
  <meta property="twitter:image" content="https://nianze.tk/images/2018/2018-03/2018-03-06.gif">





  <meta property="og:image" content="https://nianze.tk/images/bw.JPG">
  <meta property="twitter:image" content="https://nianze.tk/images/bw.JPG">


    <title>Item-40 Use multiple inheritance judiciously</title>

    <link rel="icon" href="https://nianze.tk/images/favicon.png">
    

    

    <link rel="canonical" href="https://nianze.tk/2018/03/use-multiple-inheritance-judiciously/">

    
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.css" integrity="sha256-vuXZ9LGmmwtjqFX1F+EKin1ThZMub58gKULUyf0qECk=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" integrity="sha256-SEa4XYAHihTcEP1f5gARTB2K26Uk8PsndQYHQC1f4jU=" crossorigin="anonymous" />
    
    
    <link rel="stylesheet" href="https://nianze.tk/css/style-nnm2spxvve8onlujjlegkkytaehyadd4ksxc1hyzzq9a2wvtrgbljqyulomn.min.css" />
    
    
      
        <link rel="stylesheet" href="https://nianze.tk/css/main.css">
      
    
      
        <link rel="stylesheet" href="https://nianze.tk/css/loader.css">
      
    

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-71584380-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body id="container">
    <div id="blog">
      <header id="header" data-behavior="4">
  <i id="btn-open-sidebar" class="fas fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://nianze.tk/">刀心水敲字の地方</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://nianze.tk/#about">
    
    
    
      
        <img class="header-picture" src="https://nianze.tk/images/bw.JPG" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>

      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://nianze.tk/#about">
          <img class="sidebar-profile-picture" src="https://nianze.tk/images/bw.JPG" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">刀心の水</h4>
        
          <h5 class="sidebar-profile-bio"><p>虚度廿余岁月浅，略识几行代码源。<br />
闲来随手快门按，怆然独把音韵弹。</p>

<p>Pain is inevitable.<br />
Suffering is optional.</p>
</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/">
    
      <i class="sidebar-button-icon fas fa-home" title='Home'></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories/thoughts">
    
      <i class="sidebar-button-icon fas fa-lightbulb" title='Thoughts'></i>
      
      <span class="sidebar-button-desc">Thoughts</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories/technology">
    
      <i class="sidebar-button-icon fas fa-code" title='Technology'></i>
      
      <span class="sidebar-button-desc">Technology</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories/music">
    
      <i class="sidebar-button-icon fas fa-music" title='Music'></i>
      
      <span class="sidebar-button-desc">Music</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories/visual">
    
      <i class="sidebar-button-icon fas fa-palette" title='Visual'></i>
      
      <span class="sidebar-button-desc">Visual</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/categories">
    
      <i class="sidebar-button-icon fas fa-bookmark" title='Categories'></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/tags">
    
      <i class="sidebar-button-icon fas fa-tags" title='Tags'></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/archives">
    
      <i class="sidebar-button-icon fas fa-archive" title='Archives'></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/about">
    
      <i class="sidebar-button-icon fas fa-user" title='About'></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.linkedin.com/in/nianze" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-linkedin" title='LinkedIn'></i>
      
      <span class="sidebar-button-desc">LinkedIn</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/Nianze" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-github" title='Github'></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.flickr.com/photos/129774362@N07/" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-flickr", title='Flickr'></i>
      
      <span class="sidebar-button-desc">Flickr</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://instagram.com/eznain" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-instagram" title='Instagram'></i>
      
      <span class="sidebar-button-desc">Instagram</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.facebook.com/rym.lnz" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-facebook", title='Facebook'></i>
      
      <span class="sidebar-button-desc">Facebook</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/daoxinzhishui" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-twitter", title='Twitter'></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://www.youtube.com/user/daoxinzhishui" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fab fa-youtube", title='YouTube'></i>
      
      <span class="sidebar-button-desc">YouTube</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="mailto:daoxinzhishui@gmail.com" target="_blank" rel="noopener">
    
      <i class="sidebar-button-icon fas fa-envelope", title='Email'></i>
      
      <span class="sidebar-button-desc">Email</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://nianze.tk/post/index.xml">
    
      <i class="sidebar-button-icon fas fa-rss-square", title='RSS'></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>


    </ul>
    <ul class="sidebar-buttons">
      

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      Item-40 Use multiple inheritance judiciously
    </h1>
  
  
  <div class="postShorten-meta post-meta">
    
      <time itemprop="datePublished" datetime="2018-03-06T17:35:59-05:00">
        
  March 6, 2018

      </time>
    
    
  
  
    <span>in</span>
    
      <a class="category-link" href="https://nianze.tk/categories/technology">technology</a>, 
    
      <a class="category-link" href="https://nianze.tk/categories/coding">coding</a>
    
  

  </div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <p>Being more complex than single inheritance, Multiple inheritance (MI) can lead to ambiguity issues and to the need for virtual inheritance, the latter of which imposes costs in size, speed, and complexity of initialization and assignment, so it&rsquo;s more practical to make &ldquo;empty&rdquo; virtual base classes.</p>

<h1 id="table-of-contents">Table of Contents</h1><nav id="TableOfContents">
<ul>
<li><a href="#ambiguity">Ambiguity</a></li>
<li><a href="#virtual-inheritance">Virtual inheritance</a></li>
<li><a href="#example-of-legitimate-mi-usecase">Example of legitimate MI usecase</a></li>
<li><a href="#summary">Summary</a></li>
</ul>
</nav>

<h1 id="ambiguity">Ambiguity</h1>

<p>In the realm of MI, one thing worth noting is that it becomes possible to inherit the same name (e.g., function, typedef, etc.) from more than one base class:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">BorrowableItem</span> {  <span style="color:#75715e">// something a library lets you borrow
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">void</span> checkOut();  <span style="color:#75715e">// check the item out from the library
</span><span style="color:#75715e"></span>    ...
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ElectronicGadget</span> {
<span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">bool</span> checkOut() <span style="color:#66d9ef">const</span>; <span style="color:#75715e">// perfom self-test, return whether test succeeds
</span><span style="color:#75715e"></span>    ...
};

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MP3Player</span><span style="color:#f92672">:</span>  <span style="color:#75715e">// Multiple inheritance
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> BorrowableItem,
    <span style="color:#66d9ef">public</span> ElectronicGadget
{...};
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">MP3Player mp;
mp.checkOut();  <span style="color:#75715e">// ambiguous!
</span></code></pre></div>
<p>In the example above, even though only the public one in <code>BorrowableItem</code> of the two <code>checkOut</code> functions is accessible, the call to <code>checkOut</code> is ambiguous, because before seeing whether a function is accessible, C++ first identifies the function that&rsquo;s the best match for the call, and in this case both <code>checkOut</code>s are equally good matches, so there&rsquo;s no best match. The accessibility of <code>ElectronicGadget::checkOut</code> is never examined.</p>

<p>To resolve the ambiguity, specify which base class&rsquo;s function to call:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp">mp.BorrowableItem<span style="color:#f92672">:</span><span style="color:#f92672">:</span>checkOut();
</code></pre></div>
<h1 id="virtual-inheritance">Virtual inheritance</h1>

<p>It is not uncommon in the world of MI to encounter the classical case of &ldquo;deadly MI diamond&rdquo;, where there are more than one path between a base class and a derived class:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">File</span> {...};
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InputFile</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> File{...};
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutputFile</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> File{...};
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IOFile</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> InputFile,
              <span style="color:#66d9ef">public</span> OutputFile
{...};
</code></pre></div><pre><code>          File
        ↗      ↖
InputFile       OutputFile
        ↖      ↗
         IOFile</code></pre>
<p>Here, between <code>File</code> and <code>IOFile</code>, we&rsquo;ve found two paths either through <code>InputFile</code> or <code>OutputFile</code>, and we come to the following question:</p>

<blockquote>
<p>Do we want the data members in the base class to be replicated for each of the paths?</p>
</blockquote>

<p>By default, C++ performs the replication, so if there&rsquo;s a data member named <code>fileName</code> in the <code>File</code>, <code>IOFile</code> will inherits a copy from each of its base classes <code>InputFile</code> and <code>OutputFile</code>, resulting in two <code>fielName</code> data members in <code>IOFile</code>.</p>

<p>If this is not what we want, we must make the <code>File</code> a <em>virtual base class</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">File</span> {...};
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">InputFile</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">public</span> File{...};
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OutputFile</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">public</span> File{...};
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IOFile</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> InputFile,
              <span style="color:#66d9ef">public</span> OutputFile
{...};
</code></pre></div><pre><code>           File
(virtual)↗      ↖(virtual)
InputFile       OutputFile
         ↖      ↗
         IOFile</code></pre>
<p>From the viewpoint of correct behavior, public inheritance should always be virtual. However, inheritance costs both in terms of memory and runtime: compared to their counterparts without virtual inheritance, objects created from clases using virtual inheritance are generally larger, and access to data members in virtual base classes is also slower.</p>

<p>To make things more complicated, it is required that the responsibility for initializing a virtual base is borne by the <em>most derived class</em> in the hierarchy, which implies:</p>

<ul>
<li>classes derived from virtual bases that requires initialization must be awared of their virtual bases</li>
<li>when a new derived class is added to the hierarchy, it must assume initialization responsibilities for its virtual bases (both direct and indirect).</li>
</ul>

<p>To make things easier to handle, we could adopt following strategy:</p>

<ul>
<li>Use non-virtual by default, and don&rsquo;t use virtual bases unless we need to</li>
<li>If we must use a virtual base classes, avoid putting data in them<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup></li>
</ul>

<h1 id="example-of-legitimate-mi-usecase">Example of legitimate MI usecase</h1>

<p>Multiple inheritance does have legitimate uses. One scenario involves combining public inheritance from an Interface class with private inheritance from a class that provides help of implementation.</p>

<p>For example, we want to implement the following C++ Interface class (from item 31) to model persons:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IPerson</span> {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">virtual</span><span style="color:#f92672">:</span> <span style="color:#f92672">~</span>IPerson();

    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string name() <span style="color:#66d9ef">const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string birthDate() <span style="color:#66d9ef">const</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
};
</code></pre></div>
<p>We want to create a concrete class <code>CPerson</code>, and luckily, we find following old database-specific class <code>PersonInfo</code> offering the essense of what <code>CPerson</code> needs:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PersonInfo</span> {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">explicit</span> PersonInfo(DatabaseID pid);
    <span style="color:#66d9ef">virtual</span> <span style="color:#f92672">~</span>PersonInfo();

    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">theName</span>() <span style="color:#66d9ef">const</span>;
    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">theBirthDate</span>() <span style="color:#66d9ef">const</span>;
    ...
<span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> valueDelimOpen() <span style="color:#66d9ef">const</span>;
    <span style="color:#66d9ef">virtual</span> <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">valueDelimClose</span>() <span style="color:#66d9ef">const</span>;
    ...
};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> PersonInfo<span style="color:#f92672">:</span><span style="color:#f92672">:</span>valueDilimOpen() <span style="color:#66d9ef">const</span>
{
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">[</span><span style="color:#e6db74">&#34;</span>;  <span style="color:#75715e">// default opening delimiter
</span><span style="color:#75715e"></span>}

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> PersonInfo<span style="color:#f92672">:</span><span style="color:#f92672">:</span>valueDilimClose() <span style="color:#66d9ef">const</span>
{
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">]</span><span style="color:#e6db74">&#34;</span>;  <span style="color:#75715e">// default closing delimiter
</span><span style="color:#75715e"></span>}

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> PersonInfo<span style="color:#f92672">:</span><span style="color:#f92672">:</span>theName() <span style="color:#66d9ef">const</span>
{
    <span style="color:#75715e">// reserve buffer for return value, 
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// it&#39;s automatically init. to all zeros due to static
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">char</span> value[Max_Formatted_Field_Value_Length];

    <span style="color:#75715e">// write opening delimiter
</span><span style="color:#75715e"></span>    std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>strcpy(value, valueDelimOpen());

    append <span style="color:#66d9ef">this</span> obj.<span style="color:#960050;background-color:#1e0010">&#39;</span>s name fields to the string in value

    <span style="color:#75715e">// write closing delimiter
</span><span style="color:#75715e"></span>    std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>strcat(value, valueDelimClose());

    <span style="color:#66d9ef">return</span> value;
}
</code></pre></div>
<p>This design of <code>PersonInfo::theName</code> is antiquated indeed: it use a fix-size static buffer, which is rife for both overrun and threading problems (item 21). Let&rsquo;s set such imperfection aside, and focus on <code>theName</code>, which calls virtual function <code>valueDelimOpen</code> and <code>valueDelimClose</code>, so the result returnd by <code>theName</code> is dependent not only on <code>PersonInfo</code> but also on the classes derived from <code>PersonInfo</code>.</p>

<p>Apparently, the relationship between <code>CPerson</code> and <code>PersonInfo</code> is <code>is-implemented-in-terms-of</code> (we just want to re-use some of the code. That&rsquo;s all). Also, suppose that we want our target class <code>CPerson</code> to return unadorned values (return &ldquo;Name&rdquo; instead of &ldquo;[Name]&ldquo;), which requires redefining of the virtual functions in <code>PersonInfo</code>. Thus between the composition (item 38) and private inheritance (item 39) we prefer private inheritance, because simple composition will not let us redefine the virtual functions in <code>PersonInfo</code><sup class="footnote-ref" id="fnref:2"><a href="#fn:2">2</a></sup>.</p>

<p>Thus, we could make following reasonable multiple inheritance:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-cpp" data-lang="cpp"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">IPerson</span> {...}; <span style="color:#75715e">// the interface. same as above
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DatabaseID</span> {...}; <span style="color:#75715e">// used below
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PersonInfo</span> {...};  <span style="color:#75715e">// used for implementing the IPerson interface
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CPerson</span><span style="color:#f92672">:</span> <span style="color:#66d9ef">public</span> IPerson, <span style="color:#66d9ef">private</span> PersonInfo {
<span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">explicit</span> CPerson(DatabaseID pid())<span style="color:#f92672">:</span> PersonInfo(pid) {}
    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string name() <span style="color:#66d9ef">const</span>
    { <span style="color:#66d9ef">return</span> PersonInfo<span style="color:#f92672">:</span><span style="color:#f92672">:</span>theName(); }  <span style="color:#75715e">// implementing the IPerson member function
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">virtual</span> std<span style="color:#f92672">:</span><span style="color:#f92672">:</span>string birthDate() <span style="color:#66d9ef">const</span>
    { <span style="color:#66d9ef">return</span> PersonInfo<span style="color:#f92672">:</span><span style="color:#f92672">:</span>theBirthDate(); } <span style="color:#75715e">// implementing the IPerson member function
</span><span style="color:#75715e"></span><span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> valueDelimOpen() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>; } <span style="color:#75715e">// inherited virtual delimiter functions
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">const</span> <span style="color:#66d9ef">char</span> <span style="color:#f92672">*</span> <span style="color:#a6e22e">valueDelimClose</span>() <span style="color:#66d9ef">const</span> { <span style="color:#66d9ef">return</span> <span style="color:#e6db74"></span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">&#34;</span>; } <span style="color:#75715e">// inherited virtual delimiter functions
</span><span style="color:#75715e"></span>};
</code></pre></div>
<p>In UML, the design looks like this:</p>
<pre><code>     IPerson   PersonInfo
        ↖      ↗(private)
         IOFile</code></pre>
<h1 id="summary">Summary</h1>

<p>Compared to single inheritance (SI), multiple inheritance (MI) is typically more complicated to use and more complicated to understand, so if SI design is more or less equivalent to an MI design, we prefer the SI design. Sometimes, though, MI is the clearest, most maintainable, most reasonable way to get the job done. When that&rsquo;s the case, just use it, with judiciousness.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">Without any standalone data, we don&rsquo;t worry about oddities in the initialization and assignment rules for the virtual bases. This is exactly why the Interfaces in Java and .NET, which are in many ways comparable to virtual base classes in C++, are not allowed to contain any data.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">Complex composition that is combined with public inheritance, as showed in item 39, may also meed our needs, but here we just use private inheritance because it&rsquo;s easy to understand.
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://nianze.tk/tags/technique/">technique</a>

  <a class="tag tag--primary tag--small" href="https://nianze.tk/tags/cpp/">cpp</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://nianze.tk/2018/03/understand-inplicit-interfaces-and-compile-time-polymorphism/" data-tooltip="Item-41 Understand inplicit interfaces and compile time polymorphism">
              
                  <i class="fas fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://nianze.tk/2018/03/use-private-inheritance-judiciously/" data-tooltip="Item-39 Use private inheritance judiciously">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fas fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fas fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://nianze.tk/2018/03/use-multiple-inheritance-judiciously/">
              <i class="fab fa-facebook-f"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://nianze.tk/2018/03/use-multiple-inheritance-judiciously/">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://nianze.tk/2018/03/use-multiple-inheritance-judiciously/">
              <i class="fab fa-google-plus-g"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#utteranc_thread" data-tooltip="Comments">
            <i class="fas fa-comment-dots"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents" data-tooltip="Table of Contents">
            <i class="fas fa-list"></i>
        
          </a>
      </li>
    </ul>
  
</div>

            
              
                <div id="utteranc_thread">
  <script src="https://utteranc.es/client.js"
    repo= "Nianze/personal-site-comments"
    issue-term="pathname"
    theme="github-light"
    label="✨comment 💬"
    crossorigin="anonymous"
    async>
  </script>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2020 刀心の水. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  
      <nav >
        <ul class="post-actions post-action-nav">
          
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://nianze.tk/2018/03/understand-inplicit-interfaces-and-compile-time-polymorphism/" data-tooltip="Item-41 Understand inplicit interfaces and compile time polymorphism">
              
                  <i class="fas fa-angle-left"></i>
                  <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
                </a>
            </li>
            <li class="post-action">
              
                <a class="post-action-btn btn btn--default tooltip--top" href="https://nianze.tk/2018/03/use-private-inheritance-judiciously/" data-tooltip="Item-39 Use private inheritance judiciously">
              
                  <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
                  <i class="fas fa-angle-right"></i>
                </a>
            </li>
          
        </ul>
      </nav>
    <ul class="post-actions post-action-share" >
      
        <li class="post-action hide-lg hide-md hide-sm">
          <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
            <i class="fas fa-share-alt"></i>
          </a>
        </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://nianze.tk/2018/03/use-multiple-inheritance-judiciously/">
              <i class="fab fa-facebook-f"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https://nianze.tk/2018/03/use-multiple-inheritance-judiciously/">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
        
          <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https://nianze.tk/2018/03/use-multiple-inheritance-judiciously/">
              <i class="fab fa-google-plus-g"></i>
            </a>
          </li>
        
      
      
        <li class="post-action">
          <a class="post-action-btn btn btn--default" href="#utteranc_thread" data-tooltip="Comments">
            <i class="fas fa-comment-dots"></i>
          </a>
        </li>
      
      <li class="post-action">
        
          <a class="post-action-btn btn btn--default" href="#table-of-contents" data-tooltip="Table of Contents">
            <i class="fas fa-list"></i>
        
          </a>
      </li>
    </ul>
  
</div>

      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <i id="btn-close-shareoptions" class="fas fa-times"></i>
  <ul class="share-options">
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fnianze.tk%2F2018%2F03%2Fuse-multiple-inheritance-judiciously%2F">
          <i class="fa fa-facebook-f"></i><span>Share on Facebook</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3A%2F%2Fnianze.tk%2F2018%2F03%2Fuse-multiple-inheritance-judiciously%2F">
          <i class="fa fa-twitter"></i><span>Share on Twitter</span>
        </a>
      </li>
    
      <li class="share-option">
        <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3A%2F%2Fnianze.tk%2F2018%2F03%2Fuse-multiple-inheritance-judiciously%2F">
          <i class="fa fa-google-plus-g"></i><span>Share on Google&#43;</span>
        </a>
      </li>
    
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fas fa-times"></i>
    </div>
    
      <img id="about-card-picture" src="https://nianze.tk/images/bw.JPG" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">刀心の水</h4>
    
      <div id="about-card-bio"><p>虚度廿余岁月浅，略识几行代码源。<br />
闲来随手快门按，怆然独把音韵弹。</p>

<p>Pain is inevitable.<br />
Suffering is optional.</p>
</div>
    
    
      <div id="about-card-job">
        <i class="fas fa-laptop-code"></i>
        <br/>
        Developer
      </div>
    
    
      <div id="about-card-location">
        <i class="fas fa-map-marked-alt"></i>
        <br/>
        New York
      </div>
    
  </div>
</div>

    

    
  
    
    <div id="cover" style="background-image:url('https://nianze.tk/images/road.JPG');"></div>
  


    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.7/js/jquery.fancybox.min.js" integrity="sha256-GEAnjcTqVP+vBp3SSc8bEDQqvWAZMiHyUSIorrWwH50=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/3.2.0/imagesloaded.pkgd.min.js"></script>


<script src="https://nianze.tk/js/script-qi9wbxp2ya2j6p7wx1i6tgavftewndznf4v0hy2gvivk1rxgc3lm7njqb6bz.min.js"></script>


  
    <script src="https://nianze.tk/js/loader.js"></script>
  

<script lang="javascript">
window.onload = updateMinWidth;
window.onresize = updateMinWidth;
document.getElementById("sidebar").addEventListener("transitionend", updateMinWidth);
function updateMinWidth() {
  var sidebar = document.getElementById("sidebar");
  var main = document.getElementById("main");
  main.style.minWidth = "";
  var w1 = getComputedStyle(main).getPropertyValue("min-width");
  var w2 = getComputedStyle(sidebar).getPropertyValue("width");
  var w3 = getComputedStyle(sidebar).getPropertyValue("left");
  main.style.minWidth = `calc(${w1} - ${w2} - ${w3})`;
}
</script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight > code, pre > code').each(function(i, block) {
    if (!$(this).hasClass('codeblock')) {
      $(this).addClass('codeblock');
    }
    hljs.highlightBlock(block);
  });
});
</script>





    
  </body>
</html>

